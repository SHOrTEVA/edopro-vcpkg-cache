diff --git a/src/thread.c b/src/thread.c
index 3171771d7f3..27913f0a0dd 100644
--- a/src/thread.c
+++ b/src/thread.c
@@ -72,9 +72,39 @@ int git_tlsdata_dispose(git_tlsdata_key key)
 
 #elif defined(GIT_WIN32)
 
+// On windows xp and below no callbacks will be called so some data will be leaked
+
+typedef DWORD(WINAPI *FlsAlloc_t)(PFLS_CALLBACK_FUNCTION lpCallback);
+typedef BOOL(WINAPI *FlsSetValue_t)(DWORD dwFlsIndex, PVOID lpFlsData);
+typedef PVOID(WINAPI *FlsGetValue_t)(DWORD dwFlsIndex);
+typedef BOOL(WINAPI *FlsFree_t)(DWORD dwFlsIndex);
+
+static FlsAlloc_t pFlsAlloc;
+static FlsSetValue_t pFlsSetValue;
+static FlsGetValue_t pFlsGetValue;
+static FlsFree_t pFlsFree;
+
+static DWORD WINAPI sTlsAlloc(PFLS_CALLBACK_FUNCTION lpCallback) {
+    return TlsAlloc();
+}
+
 int git_tlsdata_init(git_tlsdata_key *key, void (GIT_SYSTEM_CALL *destroy_fn)(void *))
 {
-	DWORD fls_index = FlsAlloc(destroy_fn);
+	HMODULE hModule = GetModuleHandleW(L"kernel32");
+
+	pFlsAlloc = (FlsAlloc_t)GetProcAddress(hModule, "FlsAlloc");
+	pFlsSetValue = (FlsSetValue_t)GetProcAddress(hModule, "FlsSetValue");
+	pFlsGetValue = (FlsGetValue_t)GetProcAddress(hModule, "FlsGetValue");
+	pFlsFree = (FlsFree_t)GetProcAddress(hModule, "FlsFree");
+
+	if (pFlsAlloc == NULL || pFlsSetValue == NULL || pFlsGetValue == NULL || pFlsFree == NULL) {
+	    pFlsAlloc = sTlsAlloc;
+	    pFlsSetValue = TlsSetValue;
+	    pFlsGetValue = TlsGetValue;
+	    pFlsFree = TlsFree;
+	}
+
+	DWORD fls_index = pFlsAlloc(destroy_fn);
 
 	if (fls_index == FLS_OUT_OF_INDEXES)
 		return -1;
@@ -85,7 +115,7 @@ int git_tlsdata_init(git_tlsdata_key *key, void (GIT_SYSTEM_CALL *destroy_fn)(vo
 
 int git_tlsdata_set(git_tlsdata_key key, void *value)
 {
-	if (!FlsSetValue(key, value))
+	if (!pFlsSetValue(key, value))
 		return -1;
 
 	return 0;
@@ -93,12 +123,12 @@ int git_tlsdata_set(git_tlsdata_key key, void *value)
 
 void *git_tlsdata_get(git_tlsdata_key key)
 {
-	return FlsGetValue(key);
+	return pFlsGetValue(key);
 }
 
 int git_tlsdata_dispose(git_tlsdata_key key)
 {
-	if (!FlsFree(key))
+	if (!pFlsFree(key))
 		return -1;
 
 	return 0;
